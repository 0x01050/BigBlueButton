<template name="header">
   {{#if getInSession "display_navbar"}}
      <div id="navbar" class="myNavbar navbar navbar-default navbar-static-top" role="navigation">
         {{#with getCurrentUser}}
            <div class="navbarUserButtons navbarSection">
               {{#if getInSession "display_usersList"}}
                  {{> makeButton id=userId btn_class="navbarIconToggleActive usersListIcon navbarButton" i_class="user" _id=_id rel="tooltip" data_placement="bottom" title="Hide List of Users"}}
               {{else}}
                  {{> makeButton id=userId btn_class="usersListIcon navbarButton" i_class="user" _id=_id rel="tooltip" data_placement="bottom" title="Show List of Users"}}
               {{/if}}
               
               {{#if getInSession "display_chatbar"}}
                  {{> makeButton id=userId btn_class="navbarIconToggleActive chatBarIcon navbarButton" i_class="comment" _id=_id rel="tooltip" data_placement="bottom" title="Hide Message Pane"}}
               {{else}}
                  {{> makeButton id=userId btn_class="chatBarIcon navbarButton" i_class="comment" _id=_id rel="tooltip" data_placement="bottom" title="Show Message Pane"}}
               {{/if}}

               {{#if isUserSharingVideo user}}
                  {{> makeButton id=userId btn_class="navbarIconToggleActive videoFeedIcon navbarButton" i_class="stop" sharingVideo=true _id=_id rel="tooltip" data_placement="bottom" title="Hide Webcams"}}
               {{else}}
                  {{> makeButton id=userId btn_class="videoFeedIcon navbarButton" i_class="facetime-video" sharingVideo=false _id=_id rel="tooltip" data_placement="bottom" title="Show Webcams"}}
               {{/if}}

               <!-- Join/hang up audio call -->
               {{#if isUserSharingAudio user}}
                  {{> makeButton id=userId btn_class="navbarIconToggleActive audioFeedIcon navbarButton" i_class="volume-off" sharingAudio=true _id=_id rel="tooltip" data_placement="bottom" title="Leave Audio Call"}}
               {{else}}
                  {{> makeButton id=userId btn_class="audioFeedIcon navbarButton" i_class="headphones" sharingAudio=false _id=_id rel="tooltip" data_placement="bottom" title="Join Audio Call"}}
               {{/if}}

               <!-- Mute/unmute user -->
               {{#if isUserSharingAudio user}}
               <!-- Should use much more noticeable icons than just bootstraps volume-up & volume-down to differentiate talking but it is good for now -->
                  {{#if isUserTalking user}}
                     {{> makeButton id=userId btn_class="navbarIconToggleActive muteIcon navbarButton" i_class="volume-up" sharingAudio=true _id=_id rel="tooltip" data_placement="bottom" title="Mute"}}
                  {{else}}
                     {{> makeButton id=userId btn_class="navbarIconToggleActive muteIcon navbarButton" i_class="volume-down" sharingAudio=true _id=_id rel="tooltip" data_placement="bottom" title="Unmute"}}
                  {{/if}}
               {{/if}}

               <!-- whiteboard toggle -->
               {{#if getInSession "display_whiteboard"}}
                  {{> makeButton btn_class="navbarIconToggleActive whiteboardIcon navbarButton" i_class="pencil" _id=_id rel="tooltip" data_placement="bottom" title="Hide Whiteboard"}}
               {{else}}
                  {{> makeButton id=userId btn_class="whiteboardIcon navbarButton" i_class="pencil" _id=_id rel="tooltip" data_placement="bottom" title="Show Whiteboard"}}
               {{/if}}

               {{#if user.raise_hand}}
                  {{> makeButton id=userId btn_class="lowerHand navbarIconToggleActive navbarButton" i_class="hand-up" rel="tooltip" data_placement="bottom" title="Lower your hand"}}
               {{else}}
                  {{> makeButton id=userId btn_class="raiseHand navbarButton" i_class="hand-up" rel="tooltip" data_placement="bottom" title="Raise your hand"}}
               {{/if}}
            </div>
            <div class="navbarTitle navbarSection"><span>{{getMeetingName}}</span></div>
            <div class="navbarSettingsButtons navbarSection">
               {{> makeButton id="userId" btn_class="settingsIcon navbarButton" i_class="cog" rel="tooltip" data_placement="bottom" title="Settings"}}
               {{> makeButton id="userId" btn_class="signOutIcon navbarButton" i_class="log-out" rel="tooltip" data_placement="bottom" title="Logout"}}
               {{> makeButton id="" btn_class="hideNavbarIcon navbarButton" i_class="chevron-up" rel="tooltip" data_placement="bottom" title="Hide Navbar"}}
            </div>
         {{/with}}
      </div>
   {{else}}
      <!-- User wants to hide navbar. The button for bringing the navbar back needs to still be available. Perhaps it should appear/disappear in the future on hover? Something to add later. -->
      {{> makeButton id="" btn_class="hideNavbarIcon pull-right navbarButton" i_class="chevron-down" rel="tooltip" data_placement="bottom" title="Display Navbar"}}
   {{/if}}
</template>

<template name="main">
   <head>
      <title>BigBlueButton Meteor</title>
   </head>
   <body>
      <div>
         {{>header}}
      </div>
      <div id="main" class="mainContainer row-fluid">
         {{> usersList id="users" name="usersList"}}
         {{> whiteboard id="whiteboardContainer" title="Whiteboard" name="whiteboard"}}
         {{> chatbar id="chat" title="Chat" name="chatbar"}}
      </div>
   </body>
   {{doFinalStuff}}
   <audio id="remote-media" autoplay="autoplay"></audio>
</template>
