<?xml version="1.0" encoding="utf-8"?>
<bcast:MDIWindow xmlns:mx="http://www.adobe.com/2006/mxml" 
					  xmlns:bcast="flexlib.mdi.containers.*" 
					  implements="org.bigbluebutton.common.IBbbModuleWindow" 
            creationComplete="onCreationComplete()"
					  xmlns:mate="http://mate.asfusion.com/" showCloseButton="false"
					  layout="absolute" title="Broadcast">

	<mx:Script>
		<![CDATA[
			import flexlib.mdi.events.MDIWindowEvent;			
			import mx.core.UIComponent;
			import mx.events.ResizeEvent;
			import mx.skins.Border;			
			import org.bigbluebutton.common.LogUtil;
			import org.bigbluebutton.modules.broadcast.managers.BroadcastManager;
			import org.bigbluebutton.modules.broadcast.models.BroadcastOptions;
			import org.bigbluebutton.modules.broadcast.models.Stream;
			import org.bigbluebutton.modules.broadcast.models.Streams;
			
			public var broadcastManager:BroadcastManager;
			public var curStream:Stream;
			
			[Bindable]
			private var xPosition:int = 1;
			
			[Bindable]
			private var yPosition:int = 1;
			
			[Bindable]
			private var defHeight:int = 300;
			
			[Bindable]
			private var defWidth:int = 400;
			
			public var options:BroadcastOptions;
			
			[Bindable]
			public var streams:Streams;
			
			private function onCreationComplete():void {
        options = new BroadcastOptions();
				xPosition = options.x;
				yPosition = options.y;
				defWidth = options.width;
				defHeight = options.height;
        streamsList.visible = options.showStreams;
        
        if (options.autoPlay) {
          broadcastManager.playVideo(0);
        }
      }
			
			public function becomePresenter():void{
				videoStreamList.visible = true;
				if (curStream != null) {
					playBtn.selected = true;
					playBtn.label = "Stop";
					streamsComboBox.selectedIndex = streams.getStreamIndex(curStream.getStreamId());
				} else {
					playBtn.selected = false;
					playBtn.label = "Play";				
					streamsComboBox.selectedIndex = 0;
				}
			}
			
			public function becomeViewer():void{
				videoStreamList.visible = false;
				if (curStream != null) {
					playBtn.selected = true;
					playBtn.label = "Stop";
					streamsComboBox.selectedIndex = streams.getStreamIndex(curStream.getStreamId());
				} else {
					playBtn.selected = false;
					playBtn.label = "Play";				
					streamsComboBox.selectedIndex = 0;
				}
			}
			
			private function playStopVideo():void {
				if (playBtn.selected) {
					broadcastManager.playVideo(streamsComboBox.selectedIndex);	
					playBtn.label = "Stop";
				} else {
					playBtn.label = "Play";
					stopVideo();
				}
			}
								
			private function stopVideo():void {
				broadcastManager.stopVideo();
			}
			
			public function getPrefferedPosition():String {	
				this.x = options.x;
				this.y = options.y;
				this.width = options.width;
				this.height = options.height;
				return options.position;
			}
												
		]]>
	</mx:Script>
		<mx:HBox id="videoHolderBox" width="100%" height="100%" />		
		<mx:ControlBar id="streamsList" width="100%" height="30" paddingTop="0" borderStyle="outset" horizontalAlign="center">
			<mx:HBox x="1" y="1" id="videoStreamList" width="100%" height="30" horizontalAlign="center">
				<mx:ComboBox id="streamsComboBox" width="85%" dataProvider="{streams.streamNames}" />
				<mx:Button id="playBtn" label="Play" width="15% " click="playStopVideo()" toggle="true"/>				
			</mx:HBox>
		</mx:ControlBar>
</bcast:MDIWindow>
