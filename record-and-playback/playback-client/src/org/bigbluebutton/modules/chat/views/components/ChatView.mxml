<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml"
		 xmlns:mate="http://mate.asfusion.com/"
		 creationComplete="onCreationComplete()"
		 xmlns:flexlib="http://code.google.com/p/flexlib/"
		 width="100%" height="100%" xmlns:containers="flexlib.containers.*" xmlns:components="org.bigbluebutton.modules.chat.views.components.*">

	<mate:Listener type="{ChatMessageEvent.CHAT_MESSAGE_EVENT}" method="handleChatMessageEvent" />
	<mx:Style>
		.colorPickerStyle {
			backgroundColor:#E5E6E7;
			columnCount:12;
			horizontalGap:0;
			previewHeight:22;
			previewWidth:45;
			swatchGridBackgroundColor:#000000;
			swatchGridBorderSize:0;
			swatchHeight:60;
			swatchHighlightColor:#FFFFFF;
			swatchHighlightSize:1;
			swatchWidth:12;
			textFieldWidth:72;
			verticalGap:0;
		}
		
	</mx:Style>
	
	<mx:Script>
		<![CDATA[
			import com.asfusion.mate.events.Dispatcher;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			
			import org.bigbluebutton.common.LogUtil;
			import org.bigbluebutton.modules.chat.events.ChatMessageEvent;
			
			private function onCreationComplete():void{
				
			}       
			
			
			private function parseTime() : String
			{
				//return ChatBox.getHours() + ":" + ChatBox.getMinutes();
				return "";
			}
			
			private function cleanup(message:String):String{
				var parsedString:String = message.replace('<', '&#60;')
				parsedString = parsedString.replace('>', '&#62;')
				
				return parsedString;
			}
			
			private function parseURLs(message:String):String{
				var indexOfHTTP:Number = message.indexOf("http://");
				var indexOfWWW:Number = message.indexOf("www.");
				if (indexOfHTTP == -1 && indexOfWWW == -1) return message;
				
				var words:Array = message.split(" ");
				var parsedString:String = "";
				
				for (var n:Number = 0; n<words.length; n++){
					var word:String = words[n] as String;
					if (word.indexOf("http://") != -1) parsedString += '<a href="event:' + word + '"> <u>' + word + '</u></a> ';
					else if (word.indexOf("www.") != -1) parsedString += '<a href="event:http://' + word + '"> <u>' + word + '</u></a> ';
					else parsedString += word + ' ';
				}
				return parsedString;
			}
			
			private function getParticipantName(userid:String):String{
				return "unknown user";
			}
			
			/**************************
			 * This method is called for handle the event fired...
			 * <font color="#0"><b>[markos - 12:06:38 PM]</b> heyyyyy </font><br/>
			 **************************/
			private function handleChatMessageEvent(event:ChatMessageEvent):void {
				LogUtil.debug("Got PublicChatMessageEvent");
				Alert.show("holaaaa");
				var new_message:String="<font color=\""+event.color+"\"><b>["+event.user+" - "+event.timestamp+"]</b> "+event.message+" </font><br/>";
				showMessage(new_message);
			}
			
			
			private function showMessage(message:String):void{
				chatBox.showNewMessage(message);				
			}
			
			
		]]>
	</mx:Script>
	<components:ChatBox id="chatBox" label="Public Chat" name="All"  />
</mx:VBox>